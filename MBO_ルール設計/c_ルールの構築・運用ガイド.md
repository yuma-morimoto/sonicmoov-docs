## メモ（これは本文に含まれません）
- これはコード生成の AI エージェントルール（`CLAUDE.md` / `.github/copilot-instructions.md` など）を、FEU で再現しやすい形で構築し、継続運用するためのガイドです。
- 目的は精度を魔法のように上げることではなく、案件固有のガードレールを置き、安全に実装を進めやすくすることです。
- 最初から完成形を目指さず、最小構成で始めて、実践しながら育てます。

### レビュー
  1. 「ルールとは」の定義がやや狭く、ツール依存に見えやすいです。
     今の書き方だと「自動的に読み込ませるファイル」という説明に寄っていて、ルールの本質が「AIに事前共有する判断基準・前提・制約」であることより、ファイル形式の説明に見えます。FEU向けのガイドなら、copilot-instructions.md などは“代表例”に留めて、先に目的ベースで定義したほうが伝わりやすいです。
  2. 「ルールはAIに書かせる」は、意図より強く読まれる可能性があります。
     この節は本当は「初稿作成には使えるが、採用判断は人が行う」という話だと思いますが、見出しだけ読むと“ルール作成をAIに任せるのが推奨”のように見えます。あなたの前提にある「草案まで」「人が取捨選択」と少しズレて受け取られやすいので、ここは表現を弱めたほうが安全です。
  3. 運用パートで「なぜそうするか」の理由が少し省略されていて、再現性の説明力が落ちています。example を配る、各自でローカル調整する、という方針自体はよいですが、「使用モデルや環境差があるため、本体は各自調整しやすくする」のような理由が本文側から落ちています。FEUで横展開する資料なら、運用ルールそのものより“その運用にする根拠”があるほうが納得されやすいです。

  内容面で良いところもあります。

  - 「ルールがなくても実装はできる」と先に置いていて、過度な期待を抑えられている
  - 「200行まで、長くても300行以内」で、最初の導入ハードルを下げられている
  - テンプレートが具体的で、すぐ試せる形になっている
  - 「思いつきで増やさない」が明文化されていて、運用が肥大化しにくい


  要するに、内容の骨子はかなり良いです。いま詰めるべきなのは「定義をもう少し本質寄りにする」「AI任せに見える表現を弱める」「運用方針の理由を補う」の3点です。必要なら次に、この3点だけを反映した文案をそのまま差し替え用で作れます。

---

## ルールとは

- ルールとは、AIエージェントに追加の情報を自動的に読み込ませるためのカスタムコンテキストです。`copilot-instructions.md`, `CLAUDE.md`, `AGENTS.md`などがそれにあたります。
- ルールがあることでAIエージェントが事前に追加の情報を理解した状態からタスクを開始できます。

## ルールはなぜ必要なのか

  - 結論として、ルールはなくても十分実装できます。
  - ただ、ルールがあることで、実装を指示する手間を減らすことができます。
  - また、プロジェクトに共通ルールを設けることで、実装者や利用するモデルが異なっても、コード生成結果のばらつきを抑えやすくなります。

## ルールを構築する

### まずは最小構成で始める

- 初回から細かく作り込まず、プロジェクト固有の情報やよく起きる手戻りを防ぐ内容から書き始めます。
- 目安は 200行まで、長くても300行以内です。長くなる場合は、重複や細かすぎる指示を減らします。
- コンテキストが長すぎることで、断片的に理解をしてしまう可能性があります。

### ルールテンプレート

- 構成は固定ではありません。案件に合わせて増減しつつ、ゼロから書き始めないための起点として活用してください。

```
## プロジェクト概要

> 2~3行で簡潔にプロジェクトの説明を入れます。

## 技術スタック

> 技術スタックの列挙をします。公式ドキュメントのリンクも載せると正しい仕様を取得してくれます。

## ディレクトリ構成

> 各主要ディレクトリの役割や`package-by-feature`パターンの説明を書きます。（詳細は「ナビパークのルール設計例」を参考にしてください。）

## 使用可能なコマンド

> 主要なコマンドを列挙します。（例：実行: `npm run dev`）

## 実装のガイドライン

> AIが守るべき判断基準や実装上の制約を書きます。

## ドメイン用語

> 案件固有の用語や、一般と意味がずれる言葉を定義します。
> 例：
> - **時間貸し**
>  - 意味: 駐車場を時間単位で貸し出すこと（関連: 時間貸駐車場）
>  - 英語: normal
>  - 識別子: `normal`
```

### ルールを書くときのコツ

- **具体性・簡潔性**
	- なるべく短く端的にわかりやすい説明を心がけてください。曖昧な表現を避けてください。
	- そうすることでルールを正確に理解してもらいやすくなります。
- **コード例は書かない、判断基準を中心に**
	- 具体的なコード例は基本的に書かず、判断基準を中心に書きます。
	- コード断片はすぐ古くなり、コンテキストも圧迫しやすいためです。
- **プロジェクト固有のコーディングスタイルを定義**
	- コーディングスタイルは、レビューで繰り返し指摘されるものに絞って書きます。場所は実装のガイドラインに書きます。
- **ルールはAIに書かせる**
	- ルールの初稿はAIに作らせると綺麗に書くことができます。内容の取捨選択は後から行ってください。

### ルールに書かない方が良いこと


## ルールを運用する

### ルールファイルの管理

- ルール本体は各自が調整しやすいように `git` 管理から外し、共有用の `example` を `git` 管理します。
- 新しく入るメンバーがすぐ試せるように、 `example`ルールを作成し 、各自がコピーしてローカルで微調整できるようにします。

### 更新時のルールの見直し方

- 更新するときも、「**ルールを書くときのコツ**」を参考に、情報を増やしすぎないように整理します。
- 追加は思いつきではなく、手戻り・レビュー指摘・事故などの失敗を根拠に行います。

### ルールを評価する

- 評価基準は `MBO_ルール設計/f_ルール評価ポリシー.md:1` を使います。
- ルールが守られているか、レビュー指摘や手戻りが減っているかを見て、追加・修正・削除を判断します。

```markdown

```

## ナビパークのルール設計例（200行）

```markdown
## プロジェクト概要

ナビパークが運営する駐車場をオンラインで決済できるモバイルアプリケーションサービスのフロントエンド。
Nuxt3（SPA）で構築されたWebアプリケーションをFlutterアプリのWebview内で表示している。

## 使用可能なコマンド

- 型チェック実行: `npm run typecheck`
- Prettierチェック: `npm run lint:prettier`
- ESLintチェック: `npm run lint:script`
- Stylelintチェック: `npm run lint:style`
- ユニットテスト実行: `npm run test`
- ユニットテストをウォッチモードで実行: `npm run test:watch`
- CI用テスト実行: `npm run test:ci`
- カバレッジ計測付きテスト実行: `npm run coverage`
- E2Eテスト実行: `npm run e2e`

## 実装のガイドライン

実装・修正は以下のガイドラインに従って行なってください:

- 既存の実装とユーザーの要求の整合性が合わない場合は要求が間違いである可能性があるため、実装の前に迷わずユーザーに確認を取ること
- `function`は使わずアロー関数を使う
- any型を採用する以外に方法はないか検討する
- 定数の場合は既存の定数定義を確認する
- `AGENTS.md`/`CLAUDE.md`の内容を参照した場合はそれを参照したことがわかるように言葉を発してください（例：`AGENTS.md`のコミットルールには新機能のコミットである場合、`feat`という接頭辞をつけると書いてある）

## 単体テストのルール

テストコードは以下のルールに従って作成してください:

- テストファイルは常に `__test__/ファイル名.spec.ts` の形式で作成する
- テストファイルはソースファイルと同じディレクトリ内に `__test__` ディレクトリを作成して配置する
- 例: `src/utils/useHelper.ts` のテストは `src/utils/__test__/useHelper.spec.ts`

## E2Eテストのルール

- テストは一連の処理をストーリー形式でテストする
- selectorは使わずにgetByTextやgetByRole等を使って実際にアプリで見える要素（表示テキストなど）を指定すること
- テストを実行する場合は`yarn e2e`とすること

## ドメイン用語

このプロジェクトでは、一般的な意味とは異なる定義で使われる用語が存在します。

**用語の意味は必ずここを正としてください。**

- **時間貸し**
  - 意味: 駐車場を時間単位で貸し出すこと（関連: 時間貸駐車場）
  - 英語: normal
  - 識別子: `normal`

- **月極**
  - 意味: 駐車場を月単位で貸し出すこと（関連: 月極駐車場）
  - 英語: monthly
  - 識別子: `monthly`

- **通知（お知らせ）**
  - 意味: アプリ内で配信される情報提供機能。
  - 英語: notice
  - 識別子: `notice`

- **プッシュ通知**
  - 意味: プッシュ通知機能。開封追跡機能あり
  - 英語: push, notification
  - 識別子: `push`

- **仮申込**
  - 意味: 月極駐車場の最初の簡易的な申込。本申込の前段階
  - 英語: pre application
  - 識別子: `preapplication`

- **本申込**
  - 意味: 仮申込後の正式な申込。署名・支払い・契約締結へと進む
  - 英語: application
  - 識別子: `application`

- **区画 / 車室**
  - 意味: 駐車場内の個別の駐車スペース
  - 英語: garage
  - 識別子: `garage`, `garageNumber`

- **定期利用券（パス）**
  - 意味: 一定期間特定の駐車場が使い放題になる券
  - 英語: Pass
  - 識別子: `Pass`, `UsersPass`
  - 参照: [features/pass/](src/features/pass/)

- **出庫決済**
  - 意味: 時間貸し駐車場から車を出す際の精算
  - 英語: Exit Parking Payment
  - 識別子: `EXIT_PARKING`

- **初期費用**
  - 意味: 月極契約開始時に支払う初回費用（契約手数料・保証金・日割り料金などの合計）
  - 英語: Initial Payment
  - 識別子: `InitialPayment`

- **夢なびポイント**
  - 意味: 夢なびサービス共通のポイント。決済に充当可能
  - 英語: Yumenavi Point
  - 識別子: `YumenaviPoint`
  - 参照: [features/yumenavi/](src/features/yumenavi/)

- **アカウント種別**
  - 意味: 個人会員か法人会員かの区分
  - 英語: Account Type
  - 識別子: `ACCOUNT_TYPES: PERSONAL / CORPORATION`

- **再提出**
  - 意味: 月極契約の仮申込や本申込の内容が正しくなかった場合に再提出が行われる
  - 英語: Resubmission
  - 識別子: `resubmission`

- **更新申請**
  - 意味: 月極契約の更新を申請する
  - 英語: Applicant
  - 識別子: `applicant`

- **再提出依頼**
  - 意味: 仮申込や本申込、更新申請の内容に不備があった場合に再提出の依頼が来ることをいう。依頼が来たら再提出画面から正しい情報を送らなければならない。

## 技術スタック

### コアフレームワーク・コアライブラリ

- [Nuxt3](https://nuxt.com/docs/3.x/)
- [TypeScript](https://www.typescriptlang.org/docs/)
- [Node.js 20.x](https://nodejs.org/docs/latest-v20.x/api/)
- [Vite](https://vitejs.dev/guide/)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [yup](https://github.com/jquense/yup)
- [vee-validate](https://vee-validate.logaretm.com/v4/)
- [AWS Amplify](https://docs.amplify.aws/)
- [MSW](https://mswjs.io/)

### テスト系

- [Vitest 4](https://vitest.dev/)
- [Playwright](https://playwright.dev/)

## ディレクトリ構成

このプロジェクトは **Package by Feature** アーキテクチャを採用しています。
機能ごとに関連するすべてのコード（API、コンポーネント、ロジック、型定義など）を1つのディレクトリにまとめ、機能の独立性と保守性を意識した設計になっています。

### 全体

src/
├── api/ # API層の共通実装
├── assets/ # スタイルシート（Tailwind CSS）
├── components/ # 再利用可能なUIコンポーネント
├── composables/ # Vue Composables（ロジック・状態管理）
├── config/ # アプリケーション設定
├── constants/ # グローバル定数
├── features/ # 機能別モジュール（Package by Feature）
├── layouts/ # Nuxtレイアウト
├── middleware/ # Nuxtミドルウェア
├── mocks/ # MSWモック設定
├── pages/ # Nuxtページ（ファイルベースルーティング）
├── plugins/ # Nuxtプラグイン
├── public/ # 静的アセット
├── test/ # テスト設定
├── repositories/ # APIクライアント
├── types/ # TypeScript型定義
└── utils/ # ユーティリティ関数

### 主要ディレクトリの責務

#### **features/** - 機能別モジュール（最重要）

**Package by Feature** の中核となるディレクトリ。各機能が独立したモジュールとして管理されます。

**feature内部構造:**

features/{feature-name}/
├── api/ # 機能別API実装
│ ├── {feature}Repository.ts
│ └── types/ # API型定義
├── components/ # 機能専用コンポーネント
├── composables/ # 機能専用Composables（ロジック）
│ ├── store/ # useStoreで状態管理
├── constants/ # 定数定義
│ ├── index.ts
│ └── schemas.ts # Yup検証スキーマ
├── mock/ # MSWモック実装
├── model/ # ドメインモデル
├── utils/ # 機能専用ユーティリティ
└── types/ # 機能型定義

## コミットルール

コミットメッセージと絵文字を使用して、フォーマットされたコミットを作成します。
コミットメッセージは日本語で記述してください。

- ✨ feat: 新機能
- 🐛 fix: バグ修正
- 📝 docs: ドキュメントの変更
- ♻️ refactor: 機能を変更せずにコードを再構築
- 🎨 style: コードのフォーマット、セミコロンの欠落など
- ⚡️ perf: パフォーマンスの改善
- ✅ test: テストの追加または修正
- 🧑‍💻 chore: ツール、設定、メンテナンス、コメント追加/削除
- 🚧 wip: 作業中
- 🔥 delete: コードまたはファイルの削除
- 🚑 hotfix: 重要な修正
- 🔒 security: セキュリティの改善
```
